---
title: "ã€Flutterã€‘Signals x Riverpod x MVVM ã¨ã„ã†æ–°ã—ã„è¨­è¨ˆæ‰‹æ³•ã‚’è€ƒãˆã¦ã¿ãŸ"
emoji: "ğŸŒ±"
type: "tech"
publication_name: "zoome"
topics: [flutter,dart,signals,signal,flutterhooks,riverpod,architecture]
published: true
---

# Hooks vs Signals ã§ã¯ãªã„
æœ€è¿‘ã¯ã€Œ**Flutter Hooks ã‹Signals**ã‹ã€ã¨ã„ã†è©±ã‚’ã¡ã‚‰ã»ã‚‰è¦‹èãã—ã¾ã™ãŒã€å®Ÿéš›ã«è§¦ã£ã¦ã¿ãŸé™ã‚Šã§ã¯é•ã†ã‚ˆã†ã«æ€ã„ã¾ã™ã€‚
ã¨ã„ã†ã®ã‚‚ Flutter Hooks ã¨Signalsã¯å½¹å‰²ãŒé•ã†ãŸã‚ã§ã™ã€‚

**Flutter Hooks**
Widgetã‚’æ›¸ãéš›ã®é‡è¤‡ã‚’æ¸›ã‚‰ã—ã€ã‚³ãƒ¼ãƒ‰ã‚’çŸ­ãã™ã‚‹ãŸã‚ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

**Signals**
Riverpodã®æ›¸ãæ–¹ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ã—ã€ç”»é¢æ›´æ–°ã‚’æ¸›ã‚‰ã™æ©Ÿèƒ½ã‚’å……å®Ÿã•ã›ãŸã‚ˆã†ãªçŠ¶æ…‹ç®¡ç†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
ãŸã ã—Riverpodã®ã‚ˆã†ã«ã‚¢ãƒ—ãƒªå…¨ä½“ã®çŠ¶æ…‹ç®¡ç†ã‚’ã™ã‚‹ã®ã¯ä¸å‘ã

å¤§ã¾ã‹ã«æ›¸ãã¨ã“ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™ã€‚å…¨ãé•ã„ã¾ã™ã‚ˆã­ã€‚

å…±å­˜ã‚‚å¯èƒ½ã§ **Riverpod x Flutter Hooks x Signals** ã‚‚å‡ºæ¥ã¾ã™ã€‚

# `useState`ã®ä»£ã‚ã‚Šã«`signal`ã‚’ä½¿ã†
Flutter Hooks ã¯ä¾¿åˆ©ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ãŒã€`build`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§çŠ¶æ…‹ç®¡ç†ã‚’ã™ã‚‹ä»•çµ„ã¿ä¸Šã€Widgetã‚’åˆ†å‰²ã—ãŸã‚Šã€ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ¥ã‚¯ãƒ©ã‚¹ã«ç§»ã—ãŸã‚Šã™ã‚‹ã®ã«ã¯è‹¦åŠ´ã—ã¾ã™ã€‚

`useState`ã§ç®¡ç†ã—ã¦ã„ãŸå€¤ã‚’Riverpodã®`NotifierProvider`ã«ç§»ã™ã®ãŒä¸€èˆ¬çš„ã ã¨æ€ã„ã¾ã™ãŒã€å¤‰æ•°ä¸€ã¤ç§»ã™ã®ã«çµæ§‹ãªã‚³ãƒ¼ãƒ‰é‡ã«ãªã‚Šã¾ã™ã—ã€ã‚‚ã£ã¨æ‰‹è»½ã•ãŒæ¬²ã—ã„ã¨ã“ã‚ã§ã™ã€‚

Signalsã®è‰¯ã„ã¨ã“ã‚ã¯`useState`ã¨åŒã˜ã‚ˆã†ã«æ›¸ã‘ã‚‹ä¸Šã«ã€Widgetã®å†…ã§ã‚‚å¤–ã§ã‚‚çŠ¶æ…‹ç®¡ç†ãŒå‡ºæ¥ã‚‹ã¨ã“ã‚ãªã®ã§ã€`useState`ã®ä»£ã‚ã‚Šã¨ã—ã¦`signal`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§è§£æ±ºã—ã¾ã™ã€‚

ã¾ãŸã€`effect`ã¨ã„ã†`useEffect`ã¨ä¼¼ãŸã‚ˆã†ãªãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚‹ã®ã§ã™ãŒã€ã“ã‚ŒãŒé¢ç™½ã„ä»•æ§˜ã¨ãªã£ã¦ã„ã¾ã™ã€‚

```dart
// Flutter Hooks ã®å ´åˆ

// buildãƒ¡ã‚½ãƒƒãƒ‰å†…ã§å®šç¾©ã™ã‚‹
final count1 = useState(0);
final count2 = useState(0);

useEffect(() {
  print("${count1.value}, ${count2.value}");
  return null;
}, [count1.value, count2.value]); // å¤‰æ›´é€šçŸ¥ã‚’å—ã‘ãŸã„Stateã‚’åˆ—æŒ™ã™ã‚‹

// count1ã€count2ã®ã„ãšã‚Œã‹ã®å€¤ãŒå¤‰ã‚ã‚‹ã¨ä¸Šè¨˜ã®printãŒå®Ÿè¡Œã•ã‚Œã‚‹
count1.value += 1;
```

`useEffect`ã ã¨ä¸Šè¨˜ã®ã‚ˆã†ã«æ›¸ãã¾ã™ãŒã€

```dart
// Signalsã®å ´åˆ

// åŸºæœ¬çš„ã«StatefulWidgetã‹ã€ViewModelå†…ã®å¤‰æ•°ã¨ã—ã¦å®šç¾©ã™ã‚‹
late final count1 = signal(0);
late final count2 = signal(0);

// buildãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã¯createEffectã€ãã‚Œä»¥å¤–ã§ã¯effectã‚’ä½¿ã†
createEffect(() {
  print("$count1, $count2");
});

// count1ã€count2ã®ã„ãšã‚Œã‹ã®å€¤ãŒå¤‰ã‚ã‚‹ã¨ä¸Šè¨˜ã®printãŒå®Ÿè¡Œã•ã‚Œã‚‹
count1.value += 1;
```

`signal`ã ã¨ã“ã†ãªã‚Šã¾ã™ã€‚

ãªã‚“ã¨ã€`useEffect`ã§ã¯å¿…è¦ã ã£ãŸ**å¤‰æ›´é€šçŸ¥ã‚’å—ã‘ãŸã„Stateã®åˆ—æŒ™ãŒä¸è¦**ã«ãªã£ã¦ã„ã¾ã™ã€‚
`effect`(`createEffect`) ã¯æœ€åˆã«ä¸€åº¦ã ã‘å¤‰æ›´ãŒç„¡ãã¦ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ã®ã§ã™ãŒã€ãã®æ™‚ã«å‘¼ã°ã‚ŒãŸ`signal`ã‚’æ¤œå‡ºã™ã‚‹ä»•çµ„ã¿ã«ãªã£ã¦ã„ã¾ã™ã€‚æ¥½ã§è‰¯ã„ã§ã™ã­ã€‚

ä»Šå›ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ Flutter Hooks ã‚’ä½¿ã£ã¦ã„ã¾ã›ã‚“ãŒã€`useState`ã®ä»£ã‚ã‚Šã¨ã—ã¦Signalsã‚’ä½¿ã„ã€`useAnimation`ã‚„`useTextEditingController`ãªã©ã®ã‚³ãƒ¼ãƒ‰ã‚’çŸ­ãã™ã‚‹ãŸã‚ã®ã‚‚ã®ã¯ **Flutter Hooks ã‚’ãã®ã¾ã¾ä½¿ã†**ã®ãŒä¸åº¦è‰¯ã„å¡©æ¢…ã‹ãªã¨æ€ã„ã¾ã™ã€‚

# ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹
ã„ã‚ˆã„ã‚ˆæœ¬é¡Œã®MVVMã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚
https://github.com/hyshu/flutter_signals_riverpod_mvvm_examples/tree/main/simple_counter

ç§ã¯`InheritedWidget`ã‹Providerãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ViewModelã‚’å—ã‘æ¸¡ã—ãŸã„æ´¾ã§ã™ãŒã€å¤šåˆ†é¢å€’ã ã¨è¨€ã†æ–¹ãŒå¤šãã†ãªæ°—ãŒã—ã¾ã™ç¬‘

ã¨ã„ã†ã“ã¨ã§ã€ä»£ã‚ã‚Šã«`NotifierProvider`ã§ViewModelã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•ã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚

```dart
@riverpod
class CounterNotifier extends _$CounterNotifier {
  @override
  CounterViewModel build() => CounterViewModel();
}

class CounterViewModel {
  final counter = signal(0);

  CounterViewModel() {
    effect(() {
      print("$counter");
    });
  }
}
```

`CounterViewModel`ã¨ã„ã†ViewModelã‚¯ãƒ©ã‚¹ã‚’ä½œã‚Šã€`CounterNotifier`ã¯ãã‚Œã‚’ä¿æŒã™ã‚‹ã ã‘ã®`NotifierProvider`ã¨ãªã£ã¦ã„ã¾ã™ã€‚

`build`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢ã€‚

```dart
@override
Widget build(BuildContext context, WidgetRef ref) {
  final vm = ref.watch(counterNotifierProvider);

  return Scaffold(
    body: Center(
      child: Column(mainAxisAlignment: MainAxisAlignment.center, children: [
        Watch((context) => Text('counter: ${vm.counter}')),
        ElevatedButton(onPressed: () => vm.counter.value += 1, child: const Text("+1")),
      ]),
    ),
  );
}
```

ã¾ãšã€`vm`ã¨ã„ã†å¤‰æ•°åã§`CounterViewModel`ã‚’RiverpodçµŒç”±ã§å–å¾—ã—ã¾ã™ã€‚
```dart
final vm = ref.watch(counterNotifierProvider);
```
åŸºæœ¬çš„ã«ViewModelã¨ãƒšãƒ¼ã‚¸ã¯ä¸€å¯¾ä¸€ã«ãªã‚‹ã®ã§`vm`ã¨ã„ã†åå‰ã«ã—ã¦ã„ã¾ã™ãŒã€äºŒã¤ä»¥ä¸Šã®ViewModelã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã‚ã‚‹å ´åˆã¯`counterVm`ãªã©ã®æ–¹ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚

æ¬¡ã«`signal`ã‚’ç”»é¢ä¸Šã«`Text`ã§è¡¨ç¤ºã—ã¾ã™ã€‚
`signal`ã‚’Widgetå†…ã§ä½¿ç”¨ã™ã‚‹æ™‚ã¯`Watch`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```dart
Watch((context) => Text('counter: ${vm.counter}'))
```

æœ€å¾Œã«ã‚¿ãƒƒãƒ—ã™ã‚‹ãŸã³ã«`counter`ãŒåŠ ç®—ã•ã‚Œã‚‹ãƒœã‚¿ãƒ³ã‚’ä½œã‚Šã¾ã™ã€‚

```dart
ElevatedButton(onPressed: () => vm.counter.value += 1, child: const Text("+1"))
```

ã“ã‚Œã§ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ãŸã³ã«å€¤ãŒ1ãšã¤å¢—ãˆã€ã¤ã„ã§ã«`print`ã•ã‚Œã‚‹ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã®å®Œæˆã§ã™ã€‚

![ã‚·ãƒ³ãƒ—ãƒ«ãªã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ](/images/esg8zhisw2.gif)

# ã‚‚ã£ã¨ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹

å…ˆã»ã©ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã ã¨ã‚·ãƒ³ãƒ—ãƒ«ã™ãã‚‹ã®ã§ã€ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ä¸‰ã¤ã«ã—ã¦ã¿ã¾ã™ã€‚
https://github.com/hyshu/flutter_signals_riverpod_mvvm_examples/tree/main/three_counter

```dart
class CounterViewModel {
  final counter1 = signal(0);
  final counter2 = signal(0);
  final total = signal(0);

  CounterViewModel() {
    effect(() {
      print("$counter1, $counter2");
      // effectå†…ã§ += ã‚„ -= ã‚’ä½¿ã†æ™‚ã¯untrackedå†…ã§è¡Œã†
      untracked(() => total.value += 1);
    });
  }
}
```

`print`ã§`counter1`ã¨`counter2`ã‚’å‡ºåŠ›ã™ã‚‹ã“ã¨ã§å¤‰æ›´ã‚’ç›£è¦–ã—ã€å¤‰æ›´ãŒã‚ã‚‹åº¦ã«`total`ã®å€¤ã‚’å¢—ã‚„ã—ã¦ã„ã¾ã™ã€‚
ã¡ãªã¿ã«`print`ã‚’ä½¿ã‚ãšã«`counter1.value;`ã®ã‚ˆã†ã«æ›¸ãã ã‘ã§ã‚‚OKã§ã™ã€‚

Widgetã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚
ä¸€è¦‹ã”ã¡ã‚ƒã”ã¡ã‚ƒã—ã¦ã„ã¾ã™ãŒã€å…ˆã»ã©ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã‚’`counter1`ã€`counter2`ã«å¢—ã‚„ã—ãŸã ã‘ã§ã™ã€‚
æœ€å¾Œã«`total`ã‚’ãƒœã‚¿ãƒ³æŠœãã®`Text`ã ã‘ã§è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚

```dart
return Scaffold(
  body: Center(
    child: Column(mainAxisAlignment: MainAxisAlignment.center, children: [
      Watch((context) => Text('counter1: ${vm.counter1}')),
      ElevatedButton(onPressed: () => vm.counter1.value += 1, child: const Text("+1")),
      const SizedBox(height: 30),
      Watch((context) => Text('counter2: ${vm.counter2}')),
      ElevatedButton(onPressed: () => vm.counter2.value += 1, child: const Text("+1")),
      const SizedBox(height: 30),
      Watch((context) => Text('total: ${vm.total}')),
    ]),
  ),
);
```

![3ã¤ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãŒã‚ã‚‹ã‚¢ãƒ—ãƒªã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ](/images/3yc5giaf4p.gif)

ã•ã¦ã€ã“ã‚Œã§`build`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã®çŠ¶æ…‹ç®¡ç†ã¨ãƒ­ã‚¸ãƒƒã‚¯ã‚’ViewModelã«ç§»ã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
ä»¥å‰ã¨å¤‰ã‚ã‚‰ãš`useState`ã‚‚ä½¿ãˆã‚‹ã®ã§ã€è‡ªç”±ã«é¸æŠã§ãã‚‹ã®ãŒè‰¯ã„ã§ã™ã€‚

Widgetã®åˆ†å‰²ã‚‚å®‰æ˜“ã«ãªã‚Šã¾ã—ãŸã€‚
```dart
final vm = ref.watch(counterNotifierProvider);
```
ã‚’å‘¼ã¹ã°ã€åŒã˜ãƒšãƒ¼ã‚¸å†…ã®åˆ¥Widgetã§ã‚‚`CounterViewModel`ãŒå‘¼ã³å‡ºã›ã¾ã™ã€‚

Widgetå†…ãŒè¤‡é›‘ã«ãªã£ã¦ããŸã‚‰`setState`ã®ä»£ã‚ã‚Šã«`signal`ã‚’ä½¿ã†ã¨ã‚³ãƒ¼ãƒ‰ãŒåˆ†æ•£ã§ãã¦è‰¯ã„ã­â€¦ã€ã¨æ€ã£ã¦ã„ãŸã ã‘ãŸã‚‰å¹¸ã„ã§ã™ãŒã€ä¸€ç®‡æ‰€è‰¯ããªã„ã¨ã“ã‚ãŒã‚ã‚‹ã®ã§æœ€å¾Œã«ä¿®æ­£ã—ã¾ã™ã€‚

# åŒã˜ãƒšãƒ¼ã‚¸ãŒäºŒã¤ã‚ã£ã¦ã‚‚æ­£ã—ãå‹•ä½œã•ã›ã‚‹

```dart
final vm = ref.watch(counterNotifierProvider);
```

ã“ã‚Œã¯åŒã˜ãƒšãƒ¼ã‚¸å†…ã§å…±é€šã®`CounterViewModel`ãŒå–å¾—ã§ãã¦ä¾¿åˆ©ãªã®ã§ã™ãŒã€ç”»é¢é·ç§»å¾Œã®ãƒšãƒ¼ã‚¸ã§ã‚‚`CounterViewModel`ãŒå…±é€šåŒ–ã•ã‚Œã¦ã—ã¾ã†ã¨ã„ã†å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚

![ç”»é¢é·ç§»å¾Œã‚‚ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãŒå¼•ãç¶™ãŒã‚Œã¦ã—ã¾ã£ã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ](/images/mdzrk6cgas.gif)

ãƒšãƒ¼ã‚¸é·ç§»å¾Œã‚‚ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®å€¤ãŒå¼•ãç¶™ããŸã„ã®ã§ã‚ã‚Œã°å•é¡Œã‚ã‚Šã¾ã›ã‚“ãŒã€ãã†ã§ãªã„å ´åˆã¯é·ç§»å¾Œã¯ã¡ã‚ƒã‚“ã¨0ã‹ã‚‰å§‹ã¾ã‚‹ã‚ˆã†ã«ã—ãŸã„ã§ã™ã­ã€‚

å¯¾ç­–ã¯ç°¡å˜ã§ã€`CounterNotifier`ã«å¼•æ•°ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ã™ã€‚

```dart diff
class CounterNotifier extends _$CounterNotifier {
  @override
- CounterViewModel build() => CounterViewModel();
+ CounterViewModel build(ModalRoute route) => CounterViewModel();
}
```

ãã—ã¦ã€`CounterViewModel`ã‚’å–å¾—ã™ã‚‹éš›ã«`ModalRoute.of(context)`ã‚’å¼•æ•°ã«æ¸¡ã—ã¾ã™ã€‚

```dart
final vm = ref.watch(counterNotifierProvider(ModalRoute.of(context)!);
```

ç”»é¢é·ç§»ã™ã‚‹ã¨æ–°ã—ã„`ModalRoute`ãŒä½œã‚‰ã‚Œã‚‹ä»•æ§˜ãªã®ã§ã€åŒã˜ãƒšãƒ¼ã‚¸å†…ãªã‚‰`ModalRoute.of(context)`ã§å–å¾—ã§ãã‚‹`ModalRoute`ãŒåŒã˜ã§ã‚ã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã§ãƒšãƒ¼ã‚¸ã”ã¨ã«åˆ¥å€‹ã®`CounterViewModel`ãŒå–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

![ç”»é¢é·ç§»å¾Œã¯ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãŒåˆ¥å€‹ã«ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ](/images/wd9bdrmp98.gif)

# ãŠã‚ã‚Šã«
ã‚‚ã£ã¨è¨­è¨ˆã‚’æ·±ã‚ãŸã„æ–¹ã¯ãƒ˜ãƒ«ãƒ‘ãƒ¼ç·¨ã‚‚ã”è¦§ãã ã•ã„ã€‚
https://zenn.dev/zoome/articles/629a2489c0a4be

Signalsã®åŸºæœ¬çš„ãªæ¦‚è¦ã«ã¤ã„ã¦ã‚‚ä»¥å‰è¨˜äº‹ã‚’æ›¸ã„ãŸã®ã§ã€ã“ã¡ã‚‰ã‚‚ãŠèª­ã¿ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚
https://zenn.dev/zoome/articles/934a23c014c52b

# å‚™è€ƒ
æœ¬è¨˜äº‹ã¯ä»¥ä¸‹ã®ç’°å¢ƒã§æ¤œè¨¼ã—ã¾ã—ãŸ

```
flutter_hooks: 0.20.5
flutter_riverpod: 2.5.1
riverpod_annotation: 2.3.5
riverpod_generator: 2.4.3
signals: 5.5.0

Flutter 3.24.1 â€¢ channel stable â€¢ https://github.com/flutter/flutter.git
Framework â€¢ revision 5874a72aa4 (13 days ago) â€¢ 2024-08-20 16:46:00 -0500
Engine â€¢ revision c9b9d5780d
Tools â€¢ Dart 3.5.1 â€¢ DevTools 2.37.2
```