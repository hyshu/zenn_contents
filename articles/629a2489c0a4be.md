---
title: "ã€Flutterã€‘Signals x Riverpod x MVVM ã¨ã„ã†æ–°ã—ã„è¨­è¨ˆæ‰‹æ³•ã‚’è€ƒãˆã¦ã¿ãŸ (ãƒ˜ãƒ«ãƒ‘ãƒ¼ç·¨)"
emoji: "ğŸŒ·"
type: "tech"
publication_name: "zoome"
topics: [flutter,dart,signals,signal,riverpod]
published: true
---

å‰å›ä½œã£ãŸSignalsã¨Riverpodã«ã‚ˆã‚‹MVVMã‚’ã‚‚ã†å°‘ã—æ”¹è‰¯ã—ã¾ã™ã€‚
https://zenn.dev/zoome/articles/268adc7ca2f594

# ãƒ˜ãƒ«ãƒ‘ãƒ¼ã¨ã¯
å‰ç·¨ã§ã¯ Flutter Hooks ã®`setState`ã®ä»£ã‚ã‚Šã«Signalsã®`signal`ã‚’ä½¿ã†ã¨ã€Widgetã‚’åˆ†å‰²ã—ã‚„ã™ããªã£ãŸã‚Šãƒ­ã‚¸ãƒƒã‚¯ã‚’ViewModelã«ç§»ã›ã‚‹ã‚ˆã†ã«ãªã£ãŸã‚Šã—ã¦ä¾¿åˆ©ã¨ã„ã†è©±ã‚’ã—ã¾ã—ãŸã€‚

ãŸã ã€è¨­è¨ˆã«ã“ã ã‚ã‚Šã®ã‚ã‚‹æ–¹ãªã‚‰ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ãŸæ™‚ã«å®Ÿè¡Œã™ã‚‹
```dart
vm.counter.value += 1
```
ãŒå¾®å¦™ã ãªâ€¦ã¨æ„Ÿã˜ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

ã“ã‚Œã¯Riverpod3.0ã‹ã‚‰`StateProvider`ãŒéæ¨å¥¨ã«ãªã‚Šã€ä»£ã‚ã‚Šã«`NotifierProvider`ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸç†ç”±ã¨é–¢é€£ã—ã¦ãã‚‹ã®ã§ã™ãŒã€
ã€Œ**å€¤ã®æ›´æ–°æ–¹æ³•ã‚’é™å®šã™ã‚‹ã¨ã‚³ãƒ¼ãƒ‰ãŒç®¡ç†ã—ã‚„ã™ããªã‚Šã€ä¸å…·åˆã‚‚èµ·ãã«ãããªã‚‹**ã€ã¨ã„ã†è¨­è¨ˆã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãŒã‚ã‚Šã¾ã™ã€‚

ä¾‹ãˆã°ã€ä»Šå¾Œã‚¢ãƒ—ãƒªã«æ©Ÿèƒ½ãŒå¢—ãˆã¦ã€è‰²ã€…ãªã¨ã“ã‚ã§`+=1`ã¨ã„ã†å‡¦ç†ã‚’æ›¸ãã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®å€‹æ•°ã‚’å¢—ã‚„ãã†â€¦ã¨ã‹ã€ã‚¹ãƒãƒ›ã®ã‚«ãƒ¡ãƒ©ã«æ‰‹ã‚’ã‹ã–ã™ã ã‘ã§ã‚‚`+=1`ã™ã‚‹æ©Ÿèƒ½ã‚’ä»˜ã‘ã‚ˆã†â€¦ãªã©ãªã©ã€‚

ãã®å¾Œã€
ã€Œ**1ãšã¤ã—ã‹å¢—ã‚„ã›ãªã„ã®ã¯æ­¢ã‚ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªç”±ã«å¢—ã‚„ã™å€¤ã‚’è¨­å®šã§ãã‚‹ã‚ˆã†ã«ã—ã‚ˆã†**ã€ã¨ãªã£ãŸéš›ã«ã€ãã®`+=1`ã¨æ›¸ã„ãŸç®‡æ‰€ã‚’å…¨éƒ¨ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

é¢å€’ã§ã™ã—ã€ä¸€ç®‡æ‰€ã§ã‚‚ä¿®æ­£æ¼ã‚ŒãŒã‚ã‚Œã°ä¸å…·åˆã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã­ã€‚

ãªã®ã§ã€`+=1`ã¨æ›¸ãä»£ã‚ã‚Šã«`increment`ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½œã‚Šã€ãã‚Œã§ã—ã‹æ›´æ–°ã§ããªã„ã‚ˆã†ã«ã™ã‚Œã°ã€ãã®`increment`å†…ã®å‡¦ç†ã‚’å¤‰æ›´ã™ã‚‹ã ã‘ã§å¯¾å¿œå®Œäº†ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«ã€åŒã˜å‡¦ç†ã‚’äºŒå›ä»¥ä¸Šæ›¸ãå ´åˆã«ã€å‡¦ç†éƒ¨åˆ†ã‚’ä¸€ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦ã¾ã¨ã‚ã‚‹æ‰‹æ³•ã‚’ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆHelperï¼‰ã¨è¨€ã„ã€ãƒ¡ã‚½ãƒƒãƒ‰è‡ªä½“ã¯ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã¨å‘¼ã³ã¾ã™ã€‚

# ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’è¿½åŠ ã™ã‚‹

ã§ã¯ã€å‰ç·¨ã®ã‚·ãƒ³ãƒ—ãƒ«ãªæ–¹ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã‚’æ”¹è‰¯ã—ã¦ã„ãã¾ã™ã€‚

https://github.com/hyshu/flutter_signals_riverpod_mvvm_examples/tree/main/simple_counter_with_helper

`signal`ã«ã¯ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’è€ƒæ…®ã—ã¦ã‹`readonly()`ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã‚Œã‚’æœ€åˆã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã«ä½¿ç”¨ã—ã¦ã¿ã¾ã™ã€‚

```dart diff
class CounterViewModel {
-  final counter = signal(0);
+  final counter = signal(0).readonly();

  CounterViewModel() {
    effect(() {
      print("$counter");
    });
  }
}
```

ã“ã‚Œã§ã€`counter`ãŒ`Signal`å‹ã‹ã‚‰`ReadonlySignal`å‹ã«ãªã‚Šã€`build`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§`counter.value += 1`ã¨æ›¸ã‘ãªããªã‚Šã¾ã—ãŸã€‚

æ¬¡ã«ã€`NotifierProvider`å´ã«`increment`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚
```dart diff
class CounterNotifier extends _$CounterNotifier {
  @override
  CounterViewModel build() => CounterViewModel();

+ void increment() => (state.counter as Signal).value += 1;
}
```

å®Ÿã¯`ReadonlySignal`å‹ã¯`Signal`å‹ã®è¦ªã‚¯ãƒ©ã‚¹ãªã®ã§ã€ã“ã†ã—ã¦`Signal`å‹ã«æˆ»ã—ã¦ã‚„ã‚‹ã ã‘ã§å†ã³æ›´æ–°ã§ãã¾ã™ã€‚
ã¨ã¯ã„ãˆæ¯å›`as Signal`ã¨æ›¸ãã®ã‚‚é¢å€’ãªã®ã§`extension`ã‚’ä½œã£ã¦ãŠãã¾ã™ã€‚

```dart
extension Writable<T> on ReadonlySignal<T> {
  T get writable => value;
  set writable(T value) => (this as Signal<T>).value = value;
}

void increment() => state.counter.writable += 1;
```

ã•ã¦ã€ã“ã‚Œã§`value`ã‹ã‚‰ã¯ç›´æ¥æ›´æ–°ãŒå‡ºæ¥ãªã„ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
`build`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§æ›´æ–°ã™ã‚‹æ–¹æ³•ã¯Riverpodã®`NotifierProvider`ã‚’æ›´æ–°ã™ã‚‹æ™‚ã¨åŒã˜ã§ã™ã€‚

```dart
ref.read(counterNotifierProvider.norifier).increment();
```

ãŸã ã€ã“ã‚Œã ã¨ã¡ã‚‡ã£ã¨é•·ã„ã§ã™ã‚ˆã­ã€‚ãã‚Œã«`vm`çµŒç”±ã§æ›´æ–°ã§ããŸæ–¹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚
ã¨ã„ã†ã“ã¨ã§`CounterViewModel`ã«`norifier`ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```dart diff
class CounterNotifier extends _$CounterNotifier {
  @override
- CounterViewModel build() => CounterViewModel();
+ CounterViewModel build() => CounterViewModel(counterNotifierProvider.notifier);

  void increment() => state.counter.writable.value += 1;
}

class CounterViewModel {
  final counter = signal(0);

+ final Refreshable<CounterNotifier> notifier;

- CounterViewModel() {
+ CounterViewModel(this.notifier) {
    effect(() {
      print(counter);
    });
  }
}
```

ã“ã‚Œã§`vm.notifier`ã¨æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```dart
ref.read(vm.norifier).increment();
```

æœ€å¾Œã«`build`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã®å‡¦ç†ã‚’`increment`ã«ç½®ãæ›ãˆã¾ã™ã€‚

```dart diff
@override
Widget build(BuildContext context, WidgetRef ref) {
  final vm = ref.watch(counterNotifierProvider);

  return Scaffold(
    body: Center(
      child: Column(mainAxisAlignment: MainAxisAlignment.center, children: [
        Watch((context) => Text('counter: ${vm.counter}')),
-        ElevatedButton(onPressed: () => vm.counter.value += 1, child: const Text("+1")),
+        ElevatedButton(onPressed: ref.read(vm.norifier).increment, child: const Text("+1")),
      ]),
    ),
  );
}
```

# ãŠã‚ã‚Šã«
Signalsã«ã¯ä»Šå›ã”ç´¹ä»‹ã—ãã‚Œãªã„ãã‚‰ã„æ²¢å±±ã®æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚
https://dartsignals.dev/reference/overview/

å›½å†…ã§ã‚‚Signalsã®ä½¿ã„æ–¹ã«ã¤ã„ã¦ã®è­°è«–ãŒæ·±ã¾ã£ã¦ã„ãã¨å¬‰ã—ã„ã§ã™ã€‚

# å‚™è€ƒ
æœ¬è¨˜äº‹ã¯ä»¥ä¸‹ã®ç’°å¢ƒã§æ¤œè¨¼ã—ã¾ã—ãŸ

```
flutter_riverpod: 2.5.1
riverpod_annotation: 2.3.5
riverpod_generator: 2.4.3
signals: 5.5.0

Flutter 3.24.1 â€¢ channel stable â€¢ https://github.com/flutter/flutter.git
Framework â€¢ revision 5874a72aa4 (13 days ago) â€¢ 2024-08-20 16:46:00 -0500
Engine â€¢ revision c9b9d5780d
Tools â€¢ Dart 3.5.1 â€¢ DevTools 2.37.2
```