---
title: "ã€Flutter, Dartã€‘Signalsã¨ã„ã†çŠ¶æ…‹ç®¡ç†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒé¢ç™½ã„ä»¶"
emoji: "ğŸ›œ"
type: "tech"
topics: [flutter, dart, signals, architecture]
publication_name: "zoome"
published: true
---

[signals](https://pub.dev/packages/signals)ã¨ã„ã†çŠ¶æ…‹ç®¡ç†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒé¢ç™½ã„ä»•æ§˜ã ã£ãŸã®ã§ã”ç´¹ä»‹ã—ã¾ã™ã€‚

:::message
æœ¬è¨˜äº‹ã¯ signals 5.3.0 ã«åŸºã¥ã„ã¦æ›¸ã„ã¦ã„ã¾ã™
:::

[Signals.dart](https://dartsignals.dev)

[signals](https://pub.dev/packages/signals)ã¯Reactã®è»½é‡ç‰ˆã§ã‚ã‚‹Preactã®[Signals](https://preactjs.com/blog/signal-boosting/)ã«æº–æ‹ ã—ã¦ã„ã¾ã™ã€‚

# Riverpodã¨æ¯”è¼ƒ

`int`å‹ã®å€¤ã‚’çŠ¶æ…‹ç®¡ç†ã—ãŸã„å ´åˆã€Riverpodã®`StateProvider`ã ã¨ä»¥ä¸‹ã®æ›¸ãæ–¹ã«ãªã‚Šã¾ã™ã€‚

```dart
// Riverpodã®å ´åˆ

// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦æ›¸ã
final counterProvider = StateProvider((ref) => 0);

// Textã‚¦ã‚£ã‚¸ãƒƒãƒˆã§è¡¨ç¤ºã—ãŸã„æ™‚
Text("${ref.watch(counterProvider)}");

// å€¤ã‚’æ›´æ–°ã—ãŸã„æ™‚
ref.read(counterProvider.notifier).state += 1;
```

Signalsã®å ´åˆã¯äºŒã¤ã®æ›¸ãæ–¹ãŒã‚ã‚Šã¾ã™ã€‚

```dart
// Signalsã®å ´åˆ (createSignal)

// StatefulWidgetã®Stateå†…ã«æ›¸ã
late final counter = createSignal(context, 0);

// Textã‚¦ã‚£ã‚¸ãƒƒãƒˆã§è¡¨ç¤ºã—ãŸã„æ™‚
Text("$counter");

// å€¤ã‚’æ›´æ–°ã—ãŸã„æ™‚
counter.value += 1;
```

```dart
// Signalsã®å ´åˆ (signal)

// ç‰¹ã«è¨˜è¿°å ´æ‰€ã®è¦å®šã¯ç„¡ã„
late final counter = signal(0);

// Textã‚¦ã‚£ã‚¸ãƒƒãƒˆã§è¡¨ç¤ºã—ãŸã„æ™‚
Watch((context) => Text("$counter"));
// ã¾ãŸã¯
Text("${counter.watch(context)}");

// å€¤ã‚’æ›´æ–°ã—ãŸã„æ™‚
counter.value += 1;
```

Signalsã®æ–¹ãŒã™ã£ãã‚Šã¨ã—ã¦ã„ã¾ã™ã­ã€‚

`signal`ã§ä½œæˆã™ã‚‹ã¨`BuildContext`ãŒä¸è¦ãªã®ã§Dartå˜ä½“ã§å‹•ä½œã•ã›ã‚‰ã‚Œã¦ã€`createSignal`ã§ä½œæˆã™ã‚‹ã¨`BuildContext`ãŒå¿…è¦ãªä»£ã‚ã‚Šã«ã‚‚ã£ã¨ã™ã£ãã‚Šæ›¸ã‘ã‚‹ã€ã¨ã„ã†é–¢ä¿‚ã®ã‚ˆã†ã§ã™ã€‚

# `Computed`
`Computed`ã¯Riverpodã®`Provider`ã¨å½¹å‰²ãŒä¼¼ã¦ã„ã¾ã™ã€‚

```dart
// StatefulWidgetã®Stateå†…ã«æ›¸ã
late final counter = createSignal(context, 0);
late final isOdd = createComputed(context, () => counter.value.isOdd); // counterãŒå¥‡æ•°ã ã£ãŸã‚‰true

// Textã‚¦ã‚£ã‚¸ãƒƒãƒˆã§è¡¨ç¤ºã—ãŸã„æ™‚
Text("$isOdd");

// counterã®å€¤ã‚’æ›´æ–°ã™ã‚‹ã¨isOddã‚‚å†è¨ˆç®—ã•ã‚Œã‚‹
counter.value += 1;
```

å…ˆã»ã©ã®`createSignal`ã¨`signal`ã¨åŒã˜ã‚ˆã†ã«ã€ã“ã¡ã‚‰ã‚‚`createComputed`ã¨`computed`ã¨ã„ã†é–¢ä¿‚ã«ãªã£ã¦ã„ã¾ã™ã€‚

# å€¤ã®å¤‰æ›´ã‚’å—ã‘å–ã‚‹
Streamã®`listen`ã‚„Riverpodã®`ref.listen`ã®ã‚ˆã†ã«ã€Flutterã®ç”»é¢æ›´æ–°ä»¥å¤–ã®å ´æ‰€ã§å¤‰æ›´ã‚’å—ã‘å–ã‚‹æ–¹æ³•ã§ã™ã€‚

# `effect`
`effect`å†…ã®é–¢æ•°ã§`value`ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãã®`Signal`ã®å€¤ãŒæ›´æ–°ã•ã‚Œã‚‹åº¦ã«ãã®é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
```dart
final dipose = effect(() {
  print(counter.value); // æœ€åˆã«ä¸€å›ã€ãã®å¾Œã¯counterã®å€¤ãŒæ›´æ–°ã•ã‚Œã‚‹åº¦ã«printãŒå‘¼ã°ã‚Œã‚‹
});

// æˆ»ã‚Šå€¤ã‚’å®Ÿè¡Œã™ã‚‹ã¨å¤‰æ›´ã®å—ã‘å–ã‚Šã‚’çµ‚äº† (ä»Šå›ã®å ´åˆprintãŒå‘¼ã°ã‚Œãªããªã‚‹)
dispose();
```

æ™®é€šã¯`counter.listen` ã®ã‚ˆã†ã«ã€ä½•ã®æ›´æ–°ã‚’å—ã‘å–ã‚‹ã‹ç›´æ¥æŒ‡å®šã™ã‚‹æ€ã„ã¾ã™ãŒã€
`signals`ã®å ´åˆã¯`effect`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹`Signal`ã®å¤‰æ›´ãŒã‚ã‚‹ã¨è‡ªå‹•ã§å‘¼ã°ã‚Œã¾ã™ã€‚é¢ç™½ã„ã§ã™ã­ã€‚

ä»£ã‚ã‚Šã«æœ€åˆã«ä¸€åº¦`effect`å†…ã®é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
ä»Šå›ã®å ´åˆã€ä¾‹ãˆã°Streamã®`listen`ã ã¨counterã®å€¤ãŒå¢—ãˆã‚‹åº¦ã«1ã€2ã€3â€¦ã¨å¤‰æ›´ãŒé€šçŸ¥ã•ã‚Œã¾ã™ãŒã€`effect`ã®å ´åˆ0ã€1ã€2â€¦ã¨ãªã‚Šã¾ã™ã€‚

æœ€åˆã«ä¸€å›å®Ÿè¡Œã—ãŸéš›ã«ã©ã®`Signal`ã®`value`ãŒå‘¼ã³å‡ºã•ã‚ŒãŸã®ã‹ã‚’æ¤œå‡ºã—ã€ãã®`Signal`ã®å¤‰æ›´ã‚’å—ã‘å–ã‚‹ã€ã¨ã„ã†ä»•çµ„ã¿ãªã®ã ã¨æ€ã„ã¾ã™ã€‚

# `subscribe`
`subscribe`ã¯`Signal`ã‚’æŒ‡å®šã—ã¦å¤‰æ›´ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚
Streamã‚„Riverpodã®`listen`ã¨åŒã˜ã‚ˆã†ã«æ›¸ããŸã„äººç”¨ã®ã‚‚ã®ã§ã€å†…éƒ¨å®Ÿè£…ã¯`effect`ã‚’ä½¿ç”¨ã—ãŸçŸ­ã„ã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã¾ã™ã€‚
```dart
final dispose = counter.subscribe((value) {
  print(value); // æœ€åˆã«ä¸€å›ã€ãã®å¾Œã¯counterã®å€¤ãŒæ›´æ–°ã•ã‚Œã‚‹åº¦ã«printãŒå‘¼ã°ã‚Œã‚‹
});

// æˆ»ã‚Šå€¤ã‚’å®Ÿè¡Œã™ã‚‹ã¨å¤‰æ›´ã®å—ã‘å–ã‚Šã‚’çµ‚äº† (ä»Šå›ã®å ´åˆprintãŒå‘¼ã°ã‚Œãªããªã‚‹)
dispose();
```

# `listen`
å…ˆã»ã©ã®`effect`ã¨`subscribe`ã‚’`Widget`ã®`build`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã«æ›¸ãã¨ã€ç”»é¢ãŒå†æç”»ã•ã‚Œã‚‹åº¦ã«å€¤ã®å¤‰æ›´ã‚’æ–°ã—ãå—ã‘å–ã‚‹ã‚ˆã†ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚
```dart
build(BuildContext context) {
   // ã“ã®WidgetãŒå†æç”»ã•ã‚Œã¦buildãŒå‘¼ã°ã‚Œã‚‹åº¦ã«subscribeã‚‚å‘¼ã°ã‚Œã¦ã—ã¾ã†
  counter.subscribe((value) {
    // counterã®å€¤ãŒä¸€åº¦æ›´æ–°ã•ã‚Œã‚‹ã ã‘ã§printãŒä½•å›ã‚‚å‘¼ã°ã‚Œã¦ã—ã¾ã†
    print(value);
  });

  return ...
}
```

`listen`ã¯ãã‚Œã‚’é˜²ããŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™
```dart
late final counter = createSignal(context, 0);

build(BuildContext context) {
  // ã“ã®WidgetãŒå†æç”»ã•ã‚Œã¦listenãŒå†åº¦å‘¼ã°ã‚Œã¦ã‚‚ä¸€å›åˆ†ã®ã¿é€šçŸ¥ã‚’å—ã‘å–ã‚‹
  counter.listen(context, (value) {
    print(value); 
  });

  return ...
}
```

æ³¨æ„ç‚¹ã¨ã—ã¦ã¯ã€`StatefulWidget`ã®`State`å†…ã§å®£è¨€ã—ãŸ`Signal`ã€ã¤ã¾ã‚Š`createSignal`ã®å ´åˆã¯å•é¡Œãªã„ã®ã§ã™ãŒã€
å¤–éƒ¨ã®`Signal`ã¯ãã®`Widget`ãŒç ´æ£„ã•ã‚Œã‚‹éš›ã«`unListen`ã‚’å‘¼ã¶å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```dart
// ã“ã®counterã¯Widgetã®å¤–ã§å®£è¨€ã—ã¦ã„ã‚‹
final counter = signal(0);
...

void _print() {
  print(counter.value);
}

@override
Widget build(BuildContext context) {
  counter.listen(context, _print);

  return ...
}

@override
void dispose() {
  // unListenã§é€šçŸ¥ã‚’è§£é™¤ã—ãªã„ã¨WidgetãŒéè¡¨ç¤ºã«ãªã£ãŸå¾Œã‚‚printãŒå‘¼ã°ã‚Œã¦ã—ã¾ã†
  counter.unlisten(context, _print);

  super.dispose();
}
```

# è‰¯ã„ç‚¹ã¨æ°—ã«ãªã‚‹ç‚¹
## è‰¯ã„ç‚¹
* ä»–ã®çŠ¶æ…‹ç®¡ç†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨æ¯”ã¹ã‚‹ã¨çŸ­ãç°¡æ½”ã«æ›¸ã‘ã‚‹
* å¤‰æ›´é€šçŸ¥ã®å›æ•°ã‚’æ¸›ã‚‰ã™ãŸã‚ã®æ©Ÿèƒ½ãŒå¤šã„
  * æœ¬è¨˜äº‹ã§ã¯ç´¹ä»‹ã—ã¦ã„ãªã„ãŒ`select`ã€`untracked`ã€`peek`ãªã©ãŒã‚ã‚‹
* `runApp`ã®ç›´ä¸‹ã«ç®¡ç†ç”¨Widgetã‚’ç½®ã‹ãªãã¦ã‚‚è‰¯ã„ã®ã§ã€ä»–ã®çŠ¶æ…‹ç®¡ç†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ä½µç”¨ã§ãã‚‹
  * ã‚¢ãƒ—ãƒªå…¨ä½“ã®çŠ¶æ…‹ç®¡ç†ã¯Riverpodã‚’ä½¿ç”¨ã—ã€`StatefulWidget`å†…ã§å®Œçµã™ã‚‹å ´åˆã¯`setState`ã®ä»£ã‚ã‚Šã«`createSignal`ã‚’ä½¿ã†ãªã©

## æ°—ã«ãªã‚‹ç‚¹
* `createSignal`ã¨`signal`ã§ä½œæˆã—ãŸ`Signal`ã‚’æ··åŒã—ã‚„ã™ã„

# ãŠã‚ã‚Šã«
[signals](https://pub.dev/packages/signals)ã«ã¯ä»–ã«ã‚‚`autoDispose`ã‚„`previousValue`ãªã©æ§˜ã€…ãªæ©Ÿèƒ½ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚
ãã®è¾ºã‚Šã¯Signalsã‚’æ•™ãˆã¦ãã ã•ã£ãŸJboyã•ã‚“ã®[è¨˜äº‹](https://zenn.dev/joo_hashi/articles/e543c5645bd725)ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã§æ˜¯éğŸ˜€

Signalsã¯è¨­è¨ˆã‚‚ç´ æ™´ã‚‰ã—ã„ã®ã§ã™ãŒã€ã‚³ãƒ¼ãƒ‰ãŒæ´—ç·´ã•ã‚Œã¦ã„ã‚‹ã®ã§èª­ã‚“ã§ã„ã¦å‹‰å¼·ã«ãªã‚Šã¾ã™ã€‚
https://github.com/rodydavis/signals.dart/tree/main/packages

# å‚™è€ƒ
æœ¬è¨˜äº‹ã¯ä»¥ä¸‹ã®ç’°å¢ƒã§æ¤œè¨¼ã—ã¾ã—ãŸ

```
Flutter 3.22.3 â€¢ channel stable â€¢ https://github.com/flutter/flutter.git
Framework â€¢ revision b0850beeb2 (3 weeks ago) â€¢ 2024-07-16 21:43:41 -0700
Engine â€¢ revision 235db911ba
Tools â€¢ Dart 3.4.4 â€¢ DevTools 2.34.3
```