---
title: "ã€Flutterã€‘PackageInfoã‚’PackageInfo.of(context)ã§å‘¼ã¹ã‚‹ã‚ˆã†ã«ã™ã‚‹"
emoji: "ğŸ“¦"
type: "tech"
topics: [flutter]
publication_name: "zoome"
published: true
---

`MediaQuery.of(context)`ã¨åŒã˜ã‚ˆã†ã«[package_info_plus](https://pub.dev/packages/package_info_plus)ã‚’`PackageInfo.of(context)`ã§å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã™ã‚‹æ–¹æ³•ã§ã™ã€‚

:::message
åŒã˜è¦é ˜ã§
[device_info_plus](https://pub.dev/packages/device_info_plus)ã‚’`DeviceInfo.of(context)`ã€
[battery_plus](https://pub.dev/packages/battery_plus)ã‚’`Battery.of(context)`ã§å‘¼ã¹ã‚‹ã‚ˆã†ã«ã‚‚å‡ºæ¥ã¾ã™
:::

# PackageInfoWidgetã®ä½œæˆ
```dart
import 'package:flutter/material.dart';
import 'package:package_info_plus/package_info_plus.dart' as p;

class PackageInfoWidget extends StatefulWidget implements ProxyWidget {
  @override
  final Widget child;

  const PackageInfoWidget({super.key, required this.child});

  @override
  PackageInfoWidgetState createState() => PackageInfoWidgetState();
}

class PackageInfoWidgetState extends State<PackageInfoWidget> {
  p.PackageInfo? _info;

  @override
  void initState() {
    p.PackageInfo.fromPlatform().then((value) {
      _info = value;
    });
    super.initState();
  }

  @override
  Widget build(BuildContext context) =>
      PackageInfo(() => _info, child: widget.child);
}

class PackageInfo extends InheritedWidget {
  final p.PackageInfo? Function() _getInfo;

  const PackageInfo(this._getInfo, {super.key, required super.child});

  static p.PackageInfo? maybeOf(BuildContext context) =>
      context.dependOnInheritedWidgetOfExactType<PackageInfo>()?._getInfo();

  static p.PackageInfo of(BuildContext context) {
    final result = maybeOf(context);
    assert(result != null, 'No PackageInfo found in context');
    return result!;
  }

  @override
  bool updateShouldNotify(_) => false;
}
```

`of(context)`ã§å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ã«ã¯`InheritedWidget`ãŒå¿…è¦ãªã®ã§ã™ãŒã€`InheritedWidget`ã ã‘ã ã¨ã“ã®WidgetãŒå†ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸæ™‚ã«`_info`ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€`StatefulWidget`ã‚’è¦ªã«é…ç½®ã—ã¦ã„ã¾ã™ã€‚

æœ¬æ¥ã¯ä¿æŒã—ã¦ã„ã‚‹å€¤ï¼ˆä»Šå›ã¯`_info`ï¼‰ã«å¤‰åŒ–ãŒã‚ã£ãŸå ´åˆã€`updateShouldNotify`ã§`true`ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€`p.PackageInfo`ã¯ä¸€åº¦ç”Ÿæˆã—ãŸå¾Œã¯å¤‰åŒ–ã™ã‚‹ã“ã¨ãŒãªã„ã®ã§å¸¸ã«`false`ã‚’è¿”ã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€`_info`ã‚’`InheritedWidget`ã®å¼•æ•°ã¨ã—ã¦æ¸¡ã—ã€åˆæœŸåŒ–ãŒçµ‚ã‚ã£ãŸæ™‚ã«`setState`ã§ä¸€åº¦ãƒ“ãƒ«ãƒ‰ã—ç›´ã™æ–¹æ³•ãŒFlutterã®è¨­è¨ˆã¨ã—ã¦ã¯æ­£ã—ã„ã®ã§ã™ãŒã€ç„¡é§„ã«é‡ããªã‚‹ã®ã§`_getInfo()`ã§å‘¼ã³å‡ºã™æ–¹å¼ã«ã—ã¦ã„ã¾ã™ã€‚

# å®Ÿéš›ã«åˆ©ç”¨ã™ã‚‹

ç‰¹ã«ç†ç”±ãŒãªã‘ã‚Œã°`runApp`ã®çœŸä¸‹ã«é…ç½®ã™ã‚‹ã¨æ¥½ã§ã™ã€‚

```dart
runApp(PackageInfoWidget(child: MyApp()));
```

ã“ã‚Œã§`build(BuildContext context)`å†…ã§å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```dart
print(PackageInfo.of(context).buildNumber);
```

åŸºæœ¬çš„ã«å‘¼ã³å‡ºã™é ƒã«ã¯åˆæœŸåŒ–ãŒçµ‚ã‚ã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¦ã™ãã«åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ãªã©ã€`PackageInfo`ã®åˆæœŸåŒ–ãŒé–“ã«åˆã‚ãªã„å¯èƒ½æ€§ã®ã‚ã‚‹å ´åˆã¯`maybeOf`ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

# ä½™è«‡
Flutterã¯ã€ã“ã®ã‚ˆã†ã«`InheritedWidget`ã«æµã—ãŸã„Modelã‚¯ãƒ©ã‚¹ã‚’æŒãŸã›ã‚‹æ–¹æ³•ãŒä¸€å¿œå…¬å¼ã®æ›¸ãæ–¹ã§ã™ï¼ˆ[å‚è€ƒ](https://api.flutter.dev/flutter/widgets/InheritedWidget-class.html)ï¼‰ã€‚
ã“ã‚Œã§ã¯å¿…è¦ãªModelã‚¯ãƒ©ã‚¹ã®æ•°ã ã‘`InheritedWidget`ã‚’ä½œã‚‰ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚~~è¶…é¢å€’~~

æã‚‰ãå…¬å¼ã¨ã—ã¦ã¯ã€Œ**èª°ã‹ã‚‚ã£ã¨ä¾¿åˆ©ã«`InheritedWidget`ã‚’ä½¿ãˆã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œã£ã¦ãªï¼**ã€ã¨ã„ã†è€ƒãˆã®ã‚‚ã¨ã€ã“ã®æ›¸ãæ–¹ã ã‘ã—ã‹ä½œã‚‰ãªã‹ã£ãŸã®ã ã¨æ€ã„ã¾ã™ãŒã€
ãã‚Œã«å‘¼å¿œã™ã‚‹ã‚ˆã†ã« Remi Rousselet æ°ãŒã€Œ`InheritedWidget`ã‚’ã‚‚ã£ã¨ä½¿ã„ã‚„ã™ãã€å†åˆ©ç”¨æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã®ãƒ©ãƒƒãƒ‘ãƒ¼[^1]ã€ã¨ã—ã¦[provider](https://pub.dev/packages/provider)ã‚’ä½œã‚Šã€å˜ãªã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼ã§ã¯é™ç•Œã‚’æ„Ÿã˜ãŸã®ã‹æ›´ãªã‚‹åˆ©ä¾¿æ€§ã‚’æ±‚ã‚ã¦[riverpod](https://pub.dev/packages/riverpod)ã‚’ä½œã‚Šã¾ã—ãŸã€‚

Remiæ°å‡„ã™ãã€‚

# å‚™è€ƒ
æœ¬è¨˜äº‹ã¯ä»¥ä¸‹ã®ç’°å¢ƒã§æ¤œè¨¼ã—ã¾ã—ãŸ

```
Flutter 3.19.2 â€¢ channel stable â€¢ https://github.com/flutter/flutter.git
Framework â€¢ revision 7482962148 (9 days ago) â€¢ 2024-02-27 16:51:22 -0500
Engine â€¢ revision 04817c99c9
Tools â€¢ Dart 3.3.0 â€¢ DevTools 2.31.1
```

[^1]:[provider](https://pub.dev/packages/provider)ã®å†’é ­ã«ã‚ã‚‹"A wrapper around InheritedWidget to make them easier to use and more reusable."ã®è¨³